<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<script src="dragon.min.js" async></script>

<dom-module id="function-location">
    <script>
        class FunctionLocation extends Polymer.Element {
            static get is() {
                return 'function-location';
            }
            /**
             * Get location
             * @return {object} object represents an error or a location object
             */
            getLocation() {
                return new Promise((resolve, reject) => {
                    if (navigator.geolocation) {
                        const options = {
                            enableHighAccuracy: true,
                            timeout: 7000,
                            maximumAge: 0,
                        };
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                resolve({
                                    latitude: position.coords.latitude,
                                    longitude: position.coords.longitude,
                                });
                            },
                            (err) => {
                                resolve(Error(err));
                            },
                            options);
                    }
                });
            }

                        /**
             * Converts a latitude and longitude to a geohash
             * @param {float} latitude latitude
             * @param {float} longitude longitude
             * @return {string} geohash fir the given kat and lon.
             */
            
            toGeohash(latitude, longitude) {
                return new Promise((resolve, reject) => {
                    const ratio = [16, 8, 4, 2, 1];
                    const thirtyTwoBits = '0123456789bcdefghjkmnpqrstuvwxyz';
                    const geoFence = [];
                    let values = [longitude / 180 * 100, latitude / 90 * 100];
                    for (let i = 0; i < values.length; i++) {
                        geoFence[i] = [-100, 100];
                    }
                    let goeHash = '';
                    let number = 0;
                    let charector = 0;
                    let i = 0;

                    while (goeHash.length < 10) {
                        const iteration = i++ % values.length;
                        const distasnce = geoFence[iteration];
                        const value = values[iteration];
                        const mean = (distasnce[0] + distasnce[1]) / 2;

                        if (value > mean) {
                            charector |= ratio[number];
                            distasnce[0] = mean;
                        } else {
                            distasnce[1] = mean;
                        }

                        if (number < 4) {
                            number++;
                        } else {
                            goeHash += thirtyTwoBits[charector];
                            number = 0;
                            charector = 0;
                        }
                    }
                    resolve(goeHash);
                });
            }



        } window.customElements.define(FunctionLocation.is, FunctionLocation);
    </script>
</dom-module>
